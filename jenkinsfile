pipeline {
    agent any
    environment{
        AWS_ACCESSS_KEY_ID = credentials('aws-acesss-key-id')
        AWS_SECRET_ACCESSS_KEY = credentials('aws-Secret-access-key')
        AWS_S3_bucket = "artifact-repo-12"
        Artificat_file = "hello-world.war"
    }

    stages {
        stage('Validate') {
            steps {
                sh "mvn validate"

                sh "mvn clean"
            }
        }
         stage('Build') {
            steps {
                sh "mvn compile"
            }
        }
         stage('Test') {
            steps {
                sh "mvn test"
            }
            post{
                always{
                    junit '**/target/surefire-reports/TEST-*.xml'
                }
            }
        }
         stage('Package') {
            steps {
                sh "mvn package"
            }
            post{
                success{
                    archiveArtifacts artifacts: '**/target/**.war', followSymlinks: false
                }
            }
        }

        stage('Publish Artifict to s3 bucket'){
            steps {
             sh "aws configure set region us-east-1"
             sh "aws s3 cp ./target/**.war s3://$AWS_S3_bucket/$Artificat_file"
            }
        }


        stage('Deploy'){
            steps {
                echo "LAST  stage   "

            }
        }
        

    }
}


 